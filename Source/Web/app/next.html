<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>

    <meta charset="UTF-8">
    <meta name ="viewport" content="width=device-width, initial-scale=1">
    <title>Harvest</title>
    
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-auth.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />
    
    <script>
        var config = {
            apiKey: "AIzaSyBTTgAtocwDfror-XZLi4R5rUEphTUK4PU",
            authDomain: "harvest-ios-1522082524457.firebaseapp.com",
            databaseURL: "https://harvest-ios-1522082524457.firebaseio.com",
            projectId: "harvest-ios-1522082524457",
            storageBucket: "harvest-ios-1522082524457.appspot.com",
            messagingSenderId: "167365669216"
        };
        firebase.initializeApp(config);
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        
        var uiConfig = {
            callbacks: {
                signInSuccess: function(currentUser, credential, redirectUrl) {
                    return true;
                },
                uiShown: function() {
                    document.getElementById('loader').style.display = 'none';
                }
            },
            signInFlow: 'popup',
            signInOptions: [
                firebase.auth.EmailAuthProvider.PROVIDER_ID
            ]
        };
        
        function start() {
            // The start method will wait until the DOM is loaded.
            ui.start('#firebaseui-auth-container', uiConfig);
        }
        
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var displayName = user.displayName;
                var email = user.email;
                var uid = user.uid;
                var providerData = user.providerData;
            } else {
                
            }
        });
        
        var infoRef = firebase.database().ref('location');
        infoRef.on('value', function(snapshot) {
            if (snapshot.val()) {
                var center = new google.maps.LatLng(snapshot.val().lat, snapshot.val().lng);
                map.panTo(center);
            }
        });
        
        var yieldRef = firebase.database().ref('yields');
        yieldRef.on('value', function(snapshot) {
            var yields = document.getElementById('yields');
            yields.innerHTML = "";
            
            snapshot.forEach(function(childSnapshot) {
                var obj = childSnapshot.val();
                yields.innerHTML += "<b>Date: </b>" + obj.date + "</br>";
                yields.innerHTML += "<b>Duration: </b>" + obj.duration + "</br>"; 
                yields.innerHTML += "<b>Email: </b>" + obj.email + "</br>"; 
                yields.innerHTML += "<b>Location: </b>" + obj.location.lat + "," + obj.location.lng + "</br>";
                yields.innerHTML += "<b>Yield: </b>" + obj.yield + "</br></br>";  
            });
        });
    </script>
    
</head>
<body onload="start();">
    <h3>
    To play with this add yourself as a new user at the Firebase Console. In the sidebar the people icon called authentication.
    
    log in here. Then go to the firebase console and go to the database tab in the sidebar.
    change the lat, lng value of the location node. And the map will automatically pan to that location.
    </h3>

    <div id="map"></div>
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -34.397, lng: 150.644},
                zoom: 8
            });
            var center = new google.maps.LatLng(-32, 118);
            map.panTo(center);
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTTgAtocwDfror-XZLi4R5rUEphTUK4PU&callback=initMap"
    async defer></script>
    
    <div id="yields"></div>
    
</body>
</html> 
